\ProvidesPackage{beamerinnerthemeisae}[2012/06/03]

% Beamer theme by Christophe Garion for ISAE presentation
%
% Vased on the progressbar theme by Sylvain Bouveret
% <sylvain[dot]bouveret[aT]cert[DoT]fr> feb. 2007 version 0.31 and a
% personal adaptation of progressbar theme
%
% based on the LaTeX-Beamer package :
% Copyright 2003 by Till Tantau <tantau@users.sourceforge.net>
%
% This program can be redistributed and/or modified under the terms
% of the GNU Public License, version 3.

\RequirePackage{tikz}
\RequirePackage{ifthen}

% This piece of code is just to make the code Babel-compliant with every
% language.
% It comes from:
% http://forum.mathematex.net/latex-f6/beamer-et-shorthandoff-t3851.html
\makeatletter
\newboolean{@twopt} \setboolean{@twopt}{false}
\newcommand*{\twoptoff}{\ifnum \catcode`\;=13 \catcode`\;=12 \setboolean{@twopt}{true} \fi}
\newcommand*{\twopton}{\if@twopt \catcode`\;=13 \setboolean{@twopt}{false}  \fi}

% itemize and enumerate
\setbeamertemplate{items}[ball]

% toc
\setbeamertemplate{section in toc}[ball]
\setbeamertemplate{subsection in toc}[ball unnumbered]

% blocks, mostly taken from Sylvain Bouveret's progressbar theme

\newbox\isae@blockbox
\newdimen\isae@boxheight
\newdimen\isae@boxwidth

% The ultimate trick to prevent the itemize-inside-blocks bug from happening...
\let\isae@tempitemize=\itemize
\def\isae@itemize{\ifhmode\else\vskip-0.85\topsep\fi\isae@tempitemize}

%%% Bruno's factorized version begins %%%

\newcommand{\defblock}[1][]{
  \defbeamertemplate*{block \ifx#1\@empty\else#1\space\fi begin}{isae theme}
  {
    \setbox\isae@blockbox=\hbox to 0.95\textwidth\bgroup\vbox\bgroup\vskip-0.25\baselineskip\raggedright\begin{minipage}{0.95\textwidth} \ifx\insertblocktitle\@empty\else{\usebeamerfont{block title}\usebeamercolor[fg]{block title\ifx#1\@empty\else\space#1\fi}\insertblocktitle}\\[-0.3cm]% Just to be "babel-safe"
      \twoptoff{}\tikz\draw[isae@blockline] (0, 0) -- (\textwidth, 0);\twopton{}\fi\usebeamerfont{block body\ifx#1\@empty\else\space#1\fi}\ifx\insertblocktitle\@empty\else\global\let\itemize=\isae@itemize\fi \par
  }
  \defbeamertemplate*{block \ifx#1\@empty\else#1\space\fi end}{isae theme}
  {
    \vphantom{y}
    \global\let\itemize=\isae@tempitemize\end{minipage}\vskip-0.25\baselineskip\egroup\egroup
    \isae@boxwidth=\wd\isae@blockbox
    \advance\isae@boxwidth by 0.5\baselineskip
    \isae@boxheight=\ht\isae@blockbox
    \advance\isae@boxheight by \dp\isae@blockbox
    {\parbox[t]{0cm}{
      \usebeamercolor{block body\ifx#1\@empty\else\space#1\fi}
      \tikz[baseline=(current bounding box.north)]{\draw[draw=fg!20!bg,fill=bg, rounded corners=2pt] (0, 0) rectangle (\isae@boxwidth, \isae@boxheight);} 
    }}
  {\parbox[t]{0cm}{
      \vskip0.5\baselineskip
      \ \hfill{\box\isae@blockbox}\hfill\ 
    }}\par
    \vskip-1\baselineskip
  }
}

\defblock
\defblock[example]
\defblock[alerted]

% bibliography
\defbibheading{inline-bibliography}{}
\newcommand{\printbibliographyinline}{%
  \printbibliography[segment=\therefsegment,heading=inline-bibliography]%
  \newrefsegment%
}

\newcommand{\biblioinline}[1]{
  \nocite{#1}
  \begin{center}
    \usebeamercolor{block body}
    \begin{tikzpicture}
      \draw node[draw=fg!20!bg, fill=bg, rounded corners=2pt] {\parbox{0.95\textwidth}{\vskip-0.1cm\printbibliographyinline\vskip0.1cm}};
    \end{tikzpicture}
    \twopton{}
\end{center}
}

\newcommand{\biblio}{
  \begin{center}
    \usebeamercolor{block body}
    \begin{tikzpicture}
      \draw node[draw=fg!20!bg, fill=bg, rounded corners=2pt] {\parbox{0.95\textwidth}{\vskip-0.1cm\printbibliography\vskip0.1cm}};
    \end{tikzpicture}
    \twopton{}
\end{center}
}


\mode<all>
